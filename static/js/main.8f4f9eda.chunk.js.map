{"version":3,"sources":["auth-provider.ts","components/lib.tsx","context/auth-context.tsx","utils/index.ts","utils/http.ts","utils/use-async.ts","components/error-bundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx"],"names":["baseUrl","process","localStorageKey","getToken","window","localStorage","getItem","handleUserResponse","user","setItem","token","login","data","fetch","method","headers","body","JSON","stringify","then","response","a","ok","json","Promise","reject","register","logout","removeItem","Row","styled","div","prop","between","undefined","marginBottom","props","gap","FullPage","FullPageLoading","size","FullPageErrorFallback","error","ErrorBox","ButtonNoPadding","Button","value","message","Text","type","ScreenContainer","bootstrapUser","auth","http","AuthContext","React","createContext","displayName","AuthProvider","children","useAsync","isLoading","isError","isIdle","run","setUser","setData","queryClient","useQueryClient","useMount","Provider","form","clear","useAuth","context","useContext","Error","cleanObject","object","result","Object","keys","forEach","key","isVoid","callback","useEffect","useCallback","useDebounce","delay","useState","debounceValue","setDebounceValue","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepUnmount","preTitle","useRef","document","current","restRoute","location","href","origin","useMountedRef","mountedRef","subset","obj","filteredEntries","entries","filter","includes","fromEntries","endpoint","customConfig","config","Authorization","toUpperCase","qs","status","reload","useHttp","defaultInitialState","stat","defaultConfig","throwOnError","initialState","initialConfig","state","setState","retry","setRetry","setError","promise","runConfig","prevState","catch","isSuccess","ErrorBundary","this","fallbackRender","Component","App","AuthenticatedApp","lazy","UnauthenticatedApp","className","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","QueryClient","defaultOptions","queries","refetchOnWindowFocus","QueryClientProvider","client","loadServer","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.8f4f9eda.chunk.js","sourcesContent":["//在真实环境中，如果使用firebase这种第三方auth服务的话，本文件不需要开发者开发\r\n\r\nimport {User} from \"./types/user\";\r\n\r\nconst baseUrl=process.env.REACT_APP_API_URL\r\n\r\nconst localStorageKey='__auth_provider_token__'\r\n\r\n//获取\r\nexport  const getToken=()=>window.localStorage.getItem(localStorageKey)\r\n//设置\r\nexport  const handleUserResponse=({user}:{user:User})=>{\r\n    window.localStorage.setItem(localStorageKey,user.token||'')\r\n    return user\r\n}\r\n\r\nexport const  login=(data:{username:string,password:string})=>{\r\n   return  fetch(`${baseUrl}/login`,{\r\n        method:'POST',\r\n        headers:{'Content-Type':'application/json'},\r\n        body:JSON.stringify(data)})\r\n       .then(async (response)=>{\r\n        if(response.ok){\r\n            return handleUserResponse(await response.json())\r\n        }else {\r\n            return Promise.reject(await response.json())\r\n        }\r\n    })\r\n}\r\n\r\nexport const  register=(data:{username:string,password:string})=>{\r\n    return  fetch(`${baseUrl}/register`,{\r\n        method:'POST',\r\n        headers:{'Content-Type':'application/json'},\r\n        body:JSON.stringify(data)}).then(async response=>{\r\n        if(response.ok){\r\n            return handleUserResponse(await response.json())\r\n        }else {\r\n            return Promise.reject(await response.json())\r\n        }\r\n    })\r\n}\r\n\r\nexport const logout=async ()=>window.localStorage.removeItem(localStorageKey)","import React from \"react\";\r\nimport styled from \"@emotion/styled\";\r\nimport {Button, Spin, Typography} from \"antd\";\r\nimport {DevTools} from \"jira-dev-tool/dist\";\r\n// import React from \"react\";\r\n\r\nexport const Row=styled.div<{\r\n    gap?:number|boolean\r\n    between?:boolean\r\n    marginBottom?:number\r\n}>`\r\ndisplay: flex;\r\nalign-items: center;\r\njustify-content: ${prop=>prop.between?'space-between':undefined};\r\nmargin-bottom: ${prop=>prop.marginBottom+'rem'};\r\n> * {\r\nmargin-top: 0 !important;\r\nmargin-bottom: 0 !important;\r\nmargin-right: ${props=>typeof props.gap === 'number'? props.gap+'rem':props.gap?'2rem':undefined};\r\n\r\n}\r\n`\r\nconst FullPage=styled.div`\r\nheight: 100vh;\r\ndisplay: flex;\r\nalign-items: center;\r\njustify-content: center;\r\n`\r\nexport const FullPageLoading=()=><FullPage>\r\n    <Spin size={'large'}/>\r\n</FullPage>\r\n\r\nexport const FullPageErrorFallback=({error}:{error:Error|null})=><FullPage>\r\n    <DevTools/>\r\n    <ErrorBox error={error}/>\r\n</FullPage>\r\n\r\nexport const ButtonNoPadding=styled(Button)`\r\npadding: 0;\r\n`\r\n//类型守卫\r\nconst isError=(value:any):value is Error=>value?.message\r\n\r\nexport const ErrorBox=({error}:{error:unknown})=>{\r\n    if (isError(error)){\r\n        return <Typography.Text type={\"danger\"}>{error.message}</Typography.Text>\r\n    }\r\n    return null\r\n}\r\n\r\nexport const ScreenContainer =styled.div`\r\npadding: 3.2rem;\r\nwidth: 100%;\r\ndisplay: flex;\r\nflex-direction: column;\r\n`","import React, {ReactNode} from \"react\";\r\nimport * as auth from '../auth-provider'\r\nimport {http} from \"../utils/http\";\r\nimport {useMount} from \"../utils\";\r\nimport {useAsync} from \"../utils/use-async\";\r\nimport {FullPageErrorFallback, FullPageLoading} from \"../components/lib\";\r\nimport {useQueryClient} from \"react-query\";\r\nimport {User} from \"../types/user\";\r\n\r\ninterface AuthForm {\r\n    username:string\r\n    password:string\r\n}\r\n\r\nconst bootstrapUser=async ()=>{\r\n    let user=null\r\n    const token=auth.getToken()\r\n    if (token){\r\n        const data =await http('me',{token})\r\n        user=data.user\r\n    }\r\n    return user\r\n}\r\nconst AuthContext=React.createContext<{\r\n    user:User|null\r\n    register:(form:AuthForm)=>Promise<void>\r\n    login:(form:AuthForm)=>Promise<void>\r\n    logout:()=>Promise<void>\r\n}|undefined>(undefined)\r\nAuthContext.displayName='AuthContext'\r\n//point free\r\nexport const AuthProvider=({children}:{children:ReactNode})=>{\r\n    const {data:user,error,isLoading,isError,isIdle,run,setData:setUser}=useAsync<User|null>()\r\n   const queryClient =useQueryClient()\r\n    const login=(form:AuthForm)=>auth.login(form).then(setUser)\r\n    const register=(form:AuthForm)=>auth.register(form).then(setUser)\r\n    const logout=()=>auth.logout().then(()=> {\r\n        setUser(null)\r\n        queryClient.clear()\r\n    })\r\n    useMount(()=>{\r\n        run(bootstrapUser())\r\n    })\r\n    if (isIdle||isLoading){\r\n        return <FullPageLoading/>\r\n    }\r\n    if (isError){\r\n        return <FullPageErrorFallback error={error}/>\r\n    }\r\n    return <AuthContext.Provider children={children} value={{user,login,logout,register}}/>\r\n}\r\n\r\nexport const useAuth=()=>{\r\n    const context=React.useContext(AuthContext)\r\n    if (!context){\r\n        throw new Error('useAuth必须在AuthProvider中使用')\r\n    }\r\n    return context\r\n}","import {useCallback, useEffect, useRef, useState} from \"react\"\r\n// export const isFalsy=(value:unknown)=>value===0?false:!value\r\n\r\nexport const isVoid=(value:unknown)=>value===undefined||value===null||value===''\r\n//在一个函数里改变传入的对象本身是不好的\r\nexport const cleanObject=(object?: { [key:string]:unknown })=>{\r\n    //Object.assign({},object)\r\n    const result={...object}\r\n    Object.keys(result).forEach(\r\n        key=>{\r\n            const value=result[key]\r\n            if(isVoid(value)){\r\n                delete result[key]\r\n            }\r\n        })\r\n        return result\r\n} \r\n // eslint-disable-next-line\r\nexport const useMount=(callback:()=>void)=>{\r\nuseEffect(() => {\r\n   //  依赖项里面加上callback会造成无限循环，这个和useCallback以及useMemo有关系\r\n   callback()\r\n//    eslint-disable-next-line react-hooks/exhaustive-deps\r\n},[useCallback])\r\n}\r\nexport const useDebounce=<V>(value:V,delay?:number)=>{\r\n    const [debounceValue,setDebounceValue]=useState(value)\r\n    useEffect(()=>{\r\n        //每次在value或delay变化以后设置一个定时器\r\n        const timeout=setTimeout(()=>{setDebounceValue(value)},delay)\r\n        //每次在上一个useEffect处理完以后再运行\r\n        return ()=>{clearTimeout(timeout)}\r\n    },[value,delay])\r\n    return debounceValue\r\n}\r\n\r\nexport const  useDocumentTitle=(title:string,keepUnmount:boolean=true)=>{\r\n    const preTitle=useRef(document.title).current\r\n    //页面加载时旧title\r\n    //页面加载后新title\r\n    useEffect(()=>{\r\n        document.title=title\r\n    },[title])\r\n\r\n    useEffect(()=>{\r\n        return ()=>{\r\n            if (!keepUnmount){\r\n                document.title=preTitle\r\n            }\r\n        }\r\n    },[keepUnmount,preTitle])\r\n}\r\n\r\nexport const restRoute=()=>window.location.href=window.location.origin\r\n\r\n\r\n//還沒挂載或者已經卸載返回false；反之，返回true\r\nexport const useMountedRef = ()=>{\r\n    const mountedRef=useRef(false)\r\n    useEffect(()=>{\r\n          mountedRef.current=true\r\n        return ()=>{\r\n              mountedRef.current=false\r\n        }\r\n})\r\n    return mountedRef\r\n}\r\n\r\n\r\n\r\n/**\r\n * 传入一个对象，和键集合，返回对应的对象中的键值对\r\n * @param obj\r\n * @param keys\r\n */\r\nexport const subset = <\r\n    O extends { [key in string]: unknown },\r\n    K extends keyof O\r\n    >(\r\n    obj: O,\r\n    keys: K[]\r\n) => {\r\n    const filteredEntries = Object.entries(obj).filter(([key]) =>\r\n        keys.includes(key as K)\r\n    );\r\n    return Object.fromEntries(filteredEntries) as Pick<O, K>;\r\n};","import qs from \"qs\"\r\nimport * as auth from \"../auth-provider\"\r\nimport {useAuth} from \"../context/auth-context\";\r\nimport {useCallback} from \"react\";\r\nconst baseUrl=process.env.REACT_APP_API_URL\r\ninterface Config extends RequestInit{\r\n    data?:object\r\n    token?:string\r\n}\r\n\r\nexport const http=async (endpoint:string,{data,token,headers,...customConfig}:Config={})=>{\r\n    const config={\r\n        method:'GET',\r\n        headers:{\r\n            Authorization:token?`${token}`:``,\r\n            'Content-Type':data?'application/json':''\r\n        },\r\n            ...customConfig\r\n    }\r\n    if (config.method.toUpperCase()==='GET'){\r\n        endpoint+=`?${qs.stringify(data)}`\r\n    }else {\r\n        config.body=JSON.stringify(data||{})\r\n    }\r\n\r\n    return window.fetch(`${baseUrl}/${endpoint}`,config)\r\n        .then(async response=>{\r\n            if(response.status===401){\r\n                await auth.logout()\r\n                window.location.reload()\r\n                return Promise.reject({message:'请重新登录'})\r\n            }\r\n            const data=await response.json()\r\n            if (response.ok){\r\n                return data\r\n            }else {\r\n                return Promise.reject(data)\r\n            }\r\n        })\r\n}\r\n\r\nexport const useHttp=()=>{\r\n    const {user}=useAuth()\r\n    //  TODO讲解 TS操作符\r\n    return useCallback((...[endpoint,config]:Parameters<typeof http>)=>http(endpoint,{...config,token:user?.token}),[user?.token])\r\n}\r\n","import {useCallback, useState} from \"react\";\r\nimport {useMountedRef} from \"./index\";\r\n\r\ninterface State<D>{\r\n    data:D|null\r\n    error:Error|null\r\n    stat:'idle'|'loading'|'error'|'success'\r\n}\r\nconst defaultInitialState:State<null>={\r\n    stat:'idle',\r\n    data:null,\r\n    error:null\r\n}\r\nconst defaultConfig={\r\n    throwOnError:false\r\n}\r\n\r\nexport const useAsync=<D>(initialState?:State<D>,initialConfig?:typeof defaultConfig)=>{\r\n    const config={...defaultConfig,...initialConfig}\r\n    const [state,setState]=useState<State<D>>({...defaultInitialState,...initialState})\r\n    const mountedRef=useMountedRef()\r\n    const [retry,setRetry]=useState(()=>()=>{})\r\n    const setData=useCallback((data:D)=>setState({data,stat:'success',error:null}),[])\r\n    const setError=useCallback((error:Error)=>setState({data:null,stat:\"error\",error}),[])\r\n    const run=useCallback((promise:Promise<D>,runConfig?:{retry:()=>Promise<D>})=>{\r\n            if (!promise||!promise.then){\r\n                throw new Error(\"请传入Promise类型的数据\")\r\n            }\r\n            setRetry(()=>()=>{\r\n                if (runConfig?.retry) {\r\n                    run(runConfig?.retry(), runConfig)\r\n                }\r\n            })\r\n            setState(prevState => ({...prevState,stat: 'loading'}))\r\n            return promise.then(data=> {\r\n                if (mountedRef.current){\r\n                    setData(data)\r\n                    return data\r\n                }}).catch(error=>{\r\n                //catch会消化异常，如果不主动抛出，外面是接收不到异常的\r\n                setError(error)\r\n                if (config.throwOnError) return Promise.reject(error)\r\n                return error\r\n            })\r\n        },[config.throwOnError, mountedRef, setData,setError]\r\n    )\r\n\r\n    return {\r\n        isIdle:state.stat==='idle',\r\n        isLoading:state.stat==='loading',\r\n        isError:state.stat==='error',\r\n        isSuccess:state.stat==='success',\r\n        run,\r\n        setError,\r\n        setData,\r\n        retry,\r\n        ...state\r\n    }\r\n}","import React from \"react\";\r\ntype FallbackRender = (props:{error:Error|null})=>React.ReactElement\r\n\r\nexport class  ErrorBundary extends React.Component<React.PropsWithChildren<{ fallbackRender:FallbackRender }>> {\r\n\r\n    state ={error:null}\r\n\r\n//    当组件抛出异常时，这里会接收到并且调用\r\n    static getDerivedStateFromError(error:Error){\r\n        return {error}\r\n    }\r\n\r\n    render(){\r\n        const {error}=this.state\r\n        const {fallbackRender,children}=this.props\r\n        if (error){\r\n            return fallbackRender({error})\r\n        }\r\n        return children\r\n    }\r\n}","import React from 'react';\r\n// import './App.css';\r\n// import { ProjectListScreen } from './screens/project-list';\r\n// import {Login} from './screens/login'\r\nimport {useAuth} from \"./context/auth-context\";\r\nimport {ErrorBundary} from \"./components/error-bundary\";\r\nimport {FullPageErrorFallback,FullPageLoading} from \"./components/lib\";\r\n\r\nfunction App() {\r\n  const {user}=useAuth()\r\n  const AuthenticatedApp=React.lazy(()=>import('authenticated-app'))\r\n  const UnauthenticatedApp=React.lazy(()=>import('unauthenticated-app'))\r\n\r\n  return (\r\n    <div className=\"App\">\r\n     {/* <ProjectListScreen/> */}\r\n     {/*<Login/>*/}\r\n     <ErrorBundary fallbackRender={FullPageErrorFallback}>\r\n       <React.Suspense fallback={<FullPageLoading/>}>\r\n           {user?<AuthenticatedApp/>:<UnauthenticatedApp/>}\r\n       </React.Suspense>\r\n     </ErrorBundary>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React, {ReactNode} from \"react\";\r\nimport {BrowserRouter} from \"react-router-dom\";\r\nimport {QueryClient,QueryClientProvider} from 'react-query'\r\n\r\nimport {AuthProvider} from \"./auth-context\";\r\n\r\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: {\r\n            queries: {\r\n                refetchOnWindowFocus: false,\r\n            },\r\n        },\r\n    });\r\n\r\n    return (<QueryClientProvider client={queryClient}>\r\n            <BrowserRouter>\r\n                <AuthProvider>{children}</AuthProvider>\r\n            </BrowserRouter>\r\n        </QueryClientProvider>)\r\n};","import './wdyr'\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n// import './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport {DevTools,loadServer} from \"jira-dev-tool\";\r\n//务必在jira-dev-tool后面引入\r\nimport 'antd/dist/antd.less'\r\nimport {AppProviders} from \"./context\";\r\n\r\nloadServer(()=>{\r\n    ReactDOM.render(\r\n        <React.StrictMode>\r\n            <AppProviders>\r\n                <DevTools/>\r\n                <App />\r\n            </AppProviders>\r\n        </React.StrictMode>,\r\n        document.getElementById('root')\r\n    )\r\n})\r\n\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}